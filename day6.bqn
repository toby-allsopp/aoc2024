# _trace_ â† {label _ğ•£_ F: {
#     ğ•Šğ•©:  â€¢Show "â†’"â€¿  labelâ€¿ğ•©â‹„xâ†Fğ•©â‹„ â€¢Show "â†"â€¿labelâ€¿xâ‹„x ;
#     ğ•¨ğ•Šğ•©: â€¢Show "â†’"â€¿ğ•¨â€¿labelâ€¿ğ•©â‹„xâ†ğ•¨Fğ•©â‹„â€¢Show "â†"â€¿labelâ€¿xâ‹„x
# }}
_trace_ â† {label _ğ•£_ F: {
    ğ•Šğ•©:  Fğ•© ;
    ğ•¨ğ•Šğ•©: ğ•¨Fğ•©
}}

Bitor  â† {âŠ‘âŸ¨ğ•¨âŸ©8â€¢bit._orâŸ¨ğ•©âŸ©}
Bitand â† {âŠ‘âŸ¨ğ•¨âŸ©8â€¢bit._andâŸ¨ğ•©âŸ©}
ValidIndex  â† {âˆ§Â´ğ•©â‰¥0}âˆ§{âˆ§Â´ğ•©<â‰¢ğ•¨}

dirs            â† "^>v<"
offsets         â† âŸ¨Â¯1â€¿0, 0â€¿1, 1â€¿0, 0â€¿Â¯1âŸ©
loopValue       â† â‰ dirs

DirMarkValue    â† 2âŠ¸â‹†
DirMarkChar     â† 'A'âŠ¸+
DirMark         â† DirMarkChar DirMarkValue
AddMarks        â† BitorâŒ¾(DirMarkCharâ¼)
MarkPath        â† (DirMarkâŠ£){
        ğ•Š: ğ•©='.' ? ğ•¨ ;
                   ğ•¨ AddMarks ğ•©
    }âŠ¢
PathMatches     â† {
            Â·ğ•Š'.': 0 ;
            Â·ğ•Š'#': 0 ;
                    0â‰¢(BitorÂ´DirMarkValueğ•¨) Bitand DirMarkCharâ¼ğ•©
    }

ReadInput       â† {
    board    â† >â€¢file.Lines ğ•©
    guardPos â† âŠ‘/â—‹â¥ŠâŸœ(â†•â‰¢)âˆŠâŸœdirs board
    guardDir â† âŠ‘dirsâŠguardPosâŠ‘board
    ('.'âŒ¾(guardPosâŠ¸âŠ‘) board)â€¿guardPosâ€¿guardDir
}
InBounds        â† {ğ•Šboardâ€¿posâ€¿Â·: board ValidIndex pos}
HasMark         â† {ğ•Šboardâ€¿posâ€¿dir: InBounds ğ•© ? âŸ¨dirâŸ© PathMatches posâŠ‘board ; 0}
MarkDir         â† {boardâ€¿posâ€¿dirğ•Šğ•©: dir MarkPath ğ•©}
_FollowPath     â† {Mark _ğ•£:
    {
        ğ•Šboardâ€¿posâ€¿dir: '#'=posâŠ‘board ? {nextDirâ†loopValue|dir+1â‹„âŸ¨board,                               pos+nextDir(-â—‹(âŠ‘âŸœoffsets))dir, nextDirâŸ©} ;
        ğ•Šboardâ€¿posâ€¿dir:                                          âŸ¨((ğ•©âŠ¸Mark)âˆ˜(ğ•©âŠ¸MarkDir))âŒ¾(posâŠ¸âŠ‘)board, pos+dirâŠ‘offsets,               dirâŸ©
    }â€¢_while_ (InBoundsâˆ§(Â¬HasMark))
}

Part1 â† {
    boardâ€¿Â·â€¿Â· â† âŠ¢_FollowPath ReadInput ğ•©
    â€¢Show board
    +Â´(â†•â‰ dirs)âŠ¸PathMatchesÂ¨â¥Šboard
}
part1test â† Part1 "day6testinput.txt"
â€¢Show part1test
! part1test = 41
part1result â† Part1 "day6input.txt"
â€¢Show part1result
! part1result = 4580

Part2 â† {
    inputâ€¿guardPosâ€¿guardDir â† ReadInput ğ•©
    IsLoop â† InBounds âŠ¢_FollowPath
    Mark â† {
        boardâ€¿posâ€¿dirğ•Šğ•©: '.'=posâŠ‘board ? IsLoop âŸ¨'#'âŒ¾(posâŠ¸âŠ‘)board, pos, dirâŸ© ? â€¢Show 'O'â€¿posâ€¿dirâ‹„loopValue MarkPath ğ•© ;
        boardâ€¿posâ€¿dirğ•Šğ•©: ğ•©
    }
    boardâ€¿Â·â€¿Â· â† Mark _FollowPath inputâ€¿guardPosâ€¿guardDir
    â€¢Show board
    +Â´âŸ¨loopValueâŸ©âŠ¸PathMatchesÂ¨â¥Šboard
}
part2test â† Part2 "day6testinput.txt"
â€¢Show part2test
! part2test = 6
part2result â† Part2 "day6input.txt"
â€¢Show part2result
 ! part2result = 1480
